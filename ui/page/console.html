<!DOCTYPE html>
<html>
<head>
    <title>Gopa Console</title>
    <link rel="stylesheet" href="/ui/assets/uikit-2.27.1/css/uikit.min.css" />
    <script src="/ui/assets/js/jquery.min.js"></script>
    <script src="/ui/assets/js/echarts.min.js"></script>
    <script src="/ui/assets/uikit-2.27.1/js/uikit.min.js"></script>
    <meta charset="utf-8">
</head>
<body>
<style type="text/css">
    pre{
        margin-top:0px;
        margin-bottom:0px;
        padding-top:4px;
        padding-bottom:4px;
    }
    .request pre{
     color:royalblue;
    }
</style>
<script type="text/javascript">
        $(function () {

            var conn;
            var msg = $("#msg");
            var log = $("#log");

            function appendRequestLog(msg) {
                req = $("<div class='request'><pre>" + msg + "</pre></div>");
                appendLog(req)
            }

            function appendResponseLog(msg) {
                req = $("<div class='response'><pre>" + msg + "</pre></div>");
                appendLog(req)
            }

            function appendErrorLog(msg) {
                req = $("<div class='error'><b>" + msg + "</b></div>");
                appendLog(req)
            }

            function appendLog(msg) {
                var d = log[0]
                var doScroll = d.scrollTop == d.scrollHeight - d.clientHeight;
                msg.appendTo(log)
                if (doScroll) {
                    d.scrollTop = d.scrollHeight - d.clientHeight;
                }
            }

            $("#form").submit(function () {
                if (!conn) {
                    return false;
                }
                if (!msg.val()) {
                    return false;
                }

                if(msg.val()=="CLS"||msg.val()=="cls"||msg.val()=="clear"||msg.val()=="CLEAR"){
                    log.children().remove();
                    return
                }

                conn.send(msg.val());
                appendRequestLog(msg.val())
                msg.val("");
                return false
            });

            var refreshFunc = function(){
                console.log("reconnecting");
                connect();
            };

            var tm
            function connect(){

                clearInterval(tm);

                if (window["WebSocket"]) {
                    host = location.hostname + (location.port ? ':' + location.port : '');
                    conn = new WebSocket("ws://" + host + "/ws");
                    conn.onopen = function (evt) {
                        var msg="Connection established.";
                        $("#connect_status").text(msg);
                        $("#connect_status").removeClass("uk-alert-danger").addClass("uk-alert-success");
                        clearInterval(tm);
                        console.log("remove refresh trigger")
                    }
                    conn.onclose = function (evt) {
                        var msg="Connection closed.";
                        $("#connect_status").text(msg);
                        $("#connect_status").removeClass("uk-alert-success").addClass("uk-alert-danger");
                            tm=setInterval(refreshFunc, 5000);
                            console.log("set refresh trigger")
                    }
                    conn.onmessage = function (evt) {
                        appendResponseLog(evt.data);
                    }
                } else {
                    appendErrorLog("Your browser does not support WebSockets.");
                }
            }

            connect();
        });
    </script>
<div class="uk-container uk-container-center uk-margin-top uk-margin-large-bottom">
    <nav class="uk-navbar uk-margin-large-bottom">
        <a class="uk-navbar-brand uk-hidden-small" href="/ui/">GOPA</a>
        <ul class="uk-navbar-nav uk-hidden-small">
            <li >
                <a href="/ui/page/index.html" >Home</a>
            </li>
            <li class="uk-active">
                <a href="/ui/page/console.html" >Console</a>
            </li>
            <li >
                <a href="/ui/page/tasks.html">Tasks</a>
            </li>
            <li>
                <a href="/ui/boltdb" >Boltdb</a>
            </li>
        </ul>
        <a href="#offcanvas" class="uk-navbar-toggle uk-visible-small" data-uk-offcanvas></a>
        <div class="uk-navbar-brand uk-navbar-center uk-visible-small">GOPA</div>
    </nav>

    <div class="uk-grid" data-uk-grid-margin>
        <div class="uk-width-large-1-1 uk-visible-large">

            <div id="connect_status" class="uk-alert" ></div>

            <div id="log"></div>
            <form id="form">
                <input id="msg" type="text" placeholder="" autocomplete="off" class="uk-width-1-1">
            </form>

        </div>
    </div>

</div>
</body>
</html>
