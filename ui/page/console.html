<!DOCTYPE html>
<html>
<head>
    <title>Gopa Console</title>
    <link rel="stylesheet" href="/ui/assets/uikit-2.27.1/css/uikit.min.css" />
    <script src="/ui/assets/js/jquery.min.js"></script>
    <script src="/ui/assets/js/echarts.min.js"></script>
    <script src="/ui/assets/uikit-2.27.1/js/uikit.min.js"></script>
    <meta charset="utf-8">
</head>
<body>
<script type="text/javascript">
        $(function () {

            var conn;
            var msg = $("#msg");
            var log = $("#log");

            function appendRequestLog(msg) {
                req = $("<div class='request'><pre>" + msg + "</pre></div>");
                appendLog(req)
            }

            function appendResponseLog(msg) {
                req = $("<div class='response'><pre>" + msg + "</pre></div>");
                appendLog(req)
            }

            function appendErrorLog(msg) {
                req = $("<div class='error'><b>" + msg + "</b></div>");
                appendLog(req)
            }

            function appendLog(msg) {
                var d = log[0]
                var doScroll = d.scrollTop == d.scrollHeight - d.clientHeight;
                msg.appendTo(log)
                if (doScroll) {
                    d.scrollTop = d.scrollHeight - d.clientHeight;
                }
            }

            $("#form").submit(function () {
                if (!conn) {
                    return false;
                }
                if (!msg.val()) {
                    return false;
                }
                conn.send(msg.val());
                appendRequestLog(msg.val())
                msg.val("");
                return false
            });

            if (window["WebSocket"]) {
                host = location.hostname + (location.port ? ':' + location.port : '');
                conn = new WebSocket("ws://" + host + "/ws");
                conn.onopen = function (evt) {
                    appendResponseLog("Connection established.")
                }
                conn.onclose = function (evt) {
                    appendResponseLog("Connection closed.")
                }
                conn.onmessage = function (evt) {
                    appendResponseLog(evt.data)
                }
            } else {
                appendErrorLog("Your browser does not support WebSockets.")
            }
        });
    </script>
<div class="uk-container uk-container-center uk-margin-top uk-margin-large-bottom">
    <nav class="uk-navbar uk-margin-large-bottom">
        <a class="uk-navbar-brand uk-hidden-small" href="/ui/">GOPA</a>
        <ul class="uk-navbar-nav uk-hidden-small">
            <li >
                <a href="/ui/page/index.html" >Home</a>
            </li>
            <li class="uk-active">
                <a href="/ui/page/console.html" >Console</a>
            </li>
            <li >
                <a href="/ui/page/tasks.html">Tasks</a>
            </li>
            <li>
                <a href="/ui/boltdb" >Boltdb</a>
            </li>
        </ul>
        <a href="#offcanvas" class="uk-navbar-toggle uk-visible-small" data-uk-offcanvas></a>
        <div class="uk-navbar-brand uk-navbar-center uk-visible-small">GOPA</div>
    </nav>

    <div class="uk-grid" data-uk-grid-margin>
        <div class="uk-width-large-1-1 uk-visible-large">


            <div id="log"></div>
            <form id="form">
                <input type="text" id="msg" size="64"/>
                <input type="submit" value="Send"/>
            </form>

        </div>
    </div>

</div>

<script language="javascript">

    $.ajax({
    url: '/tasks/',
    type: "post",
    dataType: "json",
    success: function(data, textStatus, jqXHR) {
        drawTable(data);
    }
});

function drawTable(data) {
    for (var i = 0; i < data.length; i++) {
        drawRow(data[i]);
    }
}

function drawRow(rowData) {
    var row = $("<tr />")
    $("#personDataTable").append(row); //this will append tr element to table... keep its reference for a while since we will add cels into it
    row.append($("<td>" + rowData.id + "</td>"));
    row.append($("<td>" + rowData.firstName + "</td>"));
    row.append($("<td>" + rowData.lastName + "</td>"));
}

</script>
</body>
</html>
