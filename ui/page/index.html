<!DOCTYPE html>
<html>
<head>
    <title>Gopa Dashboard</title>
    <link rel="stylesheet" href="/ui/assets/uikit-2.27.1/css/uikit.min.css" />
    <script src="/ui/assets/js/jquery.min.js"></script>
    <script src="/ui/assets/js/echarts.min.js"></script>
    <script src="/ui/assets/uikit-2.27.1/js/uikit.min.js"></script>
    <meta charset="utf-8">
</head>
<body>

    <div class="uk-container uk-container-center uk-margin-top uk-margin-large-bottom">
        <nav class="uk-navbar uk-margin-large-bottom">
            <a class="uk-navbar-brand uk-hidden-small" href="/ui/">GOPA</a>
            <ul class="uk-navbar-nav uk-hidden-small">

                <li class="uk-active">
                    <a href="/ui/page/index.html" >Home</a>
                </li>
                <li >
                    <a href="/ui/page/console.html" >Console</a>
                </li>
                <li >
                    <a href="/ui/page/tasks.html">Tasks</a>
                </li>
                <li>
                    <a href="/ui/boltdb" >Boltdb</a>
                </li>
            </ul>
            <a href="#offcanvas" class="uk-navbar-toggle uk-visible-small" data-uk-offcanvas></a>
            <div class="uk-navbar-brand uk-navbar-center uk-visible-small">Brand</div>
        </nav>

        <div class="uk-width-1-1">
            <div class="uk-grid">
                <div class="uk-width-1-3">Checker Task: <span id="checker_task_num">N/A</span></div>
                <div class="uk-width-1-3">Crawler Task: <span id="crawler_task_num">N/A</span></div>
            </div>
        </div>

        <div class="uk-width-1-1">
            <div id="gopa_stats" style="width: 400;height:400px;"></div>
            <script type="text/javascript">
            var myChart = echarts.init(document.getElementById('gopa_stats'));

            option = {
                tooltip : {
                    formatter: "{a} <br/>{b} : {c}%"
                },
                toolbox: {
                    feature: {
                        restore: {show: true},
                        saveAsImage: {show: true}
                    }
                },
                series: [
                    {
                        name: 'URL Checker',
                        center: ['20%', '55%'],
                        type: 'gauge',
                        detail: {formatter:'{value}%'},
                        data: [{value: 0, name: 'URL Checker'}]
                    },{
                        name: 'URL Crawler',
                        center: ['77%', '50%'],
                        type: 'gauge',
                        detail: {formatter:'{value}%'},
                        data: [{value: 0, name: 'URL Crawler'}]
                    }
                ]
            };

            myChart.setOption(option);

            timeTicket = setInterval(function () {

                // 异步加载数据
                $.get('/stats').done(function (data) {
                    if(data["checker.url"]){
                        $("#checker_task_num").text(data["checker.url"].get_valid_seed+" / "+data["checker.url"].walk);
                        option.series[0].data[0].value = ((data["checker.url"].get_valid_seed/data["checker.url"].walk)*100).toFixed(2) - 0;
                    }

                    if(data["crawler.pipeline"]){
                        $("#crawler_task_num").text(data["crawler.pipeline"].finished+" + "+data["crawler.pipeline"].error+" / "+data["crawler.pipeline"].total);
                        option.series[1].data[0].value = (((parseInt(data["crawler.pipeline"].finished)+parseInt(data["crawler.pipeline"].error))/parseInt(data["crawler.pipeline"].total))*100).toFixed(2) - 0;
                    }

                    myChart.setOption(option, true);
                });

            },2000);


        </script>
        </div>


        <div class="uk-grid" data-uk-grid-margin>
            <div class="uk-width-large-1-1 uk-visible-large">


                   <table id="example" class="uk-table uk-table-hover uk-table-striped" cellspacing="0" width="100%">
                       <thead>
                       <tr>
                           <th>CreateTime</th>
                           <th>Domain</th>
                           <th>Url</th>
                           <th>Age</th>
                           <th>Start date</th>
                           <th>Salary</th>
                       </tr>
                       </thead>
                       <tbody>
                       <tr>
                           <td>Tiger Nixon</td>
                           <td>System Architect</td>
                           <td>Edinburgh</td>
                           <td>61</td>
                           <td>2011/04/25</td>
                           <td>$320,800</td>
                       </tr>
                       <tr>
                           <td>Garrett Winters</td>
                           <td>Accountant</td>
                           <td>Tokyo</td>
                           <td>63</td>
                           <td>2011/07/25</td>
                           <td>$170,750</td>
                       </tr>
                       <tr>
                           <td>Ashton Cox</td>
                           <td>Junior Technical Author</td>
                           <td>San Francisco</td>
                           <td>66</td>
                           <td>2009/01/12</td>
                           <td>$86,000</td>
                       </tr>
                       <tr>
                           <td>Donna Snider</td>
                           <td>Customer Support</td>
                           <td>New York</td>
                           <td>27</td>
                           <td>2011/01/25</td>
                           <td>$112,000</td>
                       </tr>
                       </tbody>
                   </table>



            </div>
        </div>

    </div>

<script language="javascript">

    $.ajax({
    url: '/tasks/',
    type: "post",
    dataType: "json",
    success: function(data, textStatus, jqXHR) {
        drawTable(data);
    }
});

function drawTable(data) {
    for (var i = 0; i < data.length; i++) {
        drawRow(data[i]);
    }
}

function drawRow(rowData) {
    var row = $("<tr />")
    $("#personDataTable").append(row); //this will append tr element to table... keep its reference for a while since we will add cels into it
    row.append($("<td>" + rowData.id + "</td>"));
    row.append($("<td>" + rowData.firstName + "</td>"));
    row.append($("<td>" + rowData.lastName + "</td>"));
}

</script>
</body>
</html>
